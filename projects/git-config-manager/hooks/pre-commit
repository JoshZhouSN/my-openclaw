#!/usr/bin/env python3
"""
Pre-commit hook to validate openclaw.json configuration
"""

import json
import sys
import os
from pathlib import Path

def validate_openclaw_config():
    """Validate the openclaw.json configuration file"""
    config_path = Path('.').parent / 'openclaw.json'  # This hook is in .git/hooks/
    
    if not config_path.exists():
        print("openclaw.json not found in parent directory")
        return False
    
    try:
        with open(config_path, 'r') as f:
            config = json.load(f)
        
        # Perform basic validation
        if not isinstance(config, dict):
            print("Configuration must be a JSON object")
            return False
        
        # Check for common critical sections
        required_sections = ['agents', 'models', 'channels'] if any(
            section in config for section in ['agents', 'models', 'channels']
        ) else []
        
        # If these sections exist, validate their structure
        for section in required_sections:
            if section in config and not isinstance(config[section], dict):
                print(f"Section '{section}' must be a dictionary")
                return False
        
        print("✓ Configuration validation passed")
        return True
        
    except json.JSONDecodeError as e:
        print(f"✗ Invalid JSON in configuration: {e}")
        return False
    except Exception as e:
        print(f"✗ Error validating configuration: {e}")
        return False

if __name__ == "__main__":
    if not validate_openclaw_config():
        print("Configuration validation failed - commit blocked")
        sys.exit(1)
    
    print("Pre-commit checks passed")
    sys.exit(0)